name: Docker Django CI Test

on:
  push:
    branches: [master]
  pull_request:
    types: [opened]
    branches: [master]

env:
  GITHUB_USER: NaotoWada
  GITHUB_EMAIL: naoto.oct25@gmail.com

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - name: Clone repository
        uses: actions/checkout@v2
      - name: Setup git user
        run: |
          git config --local user.name "${GITHUB_USER}"
          git config --local user.email "${GITHUB_EMAIL}"
      - name: Change chmod
        run: |
          chmod +x manage.py
          git add manage.py
          git commit
      - name: Docker compose up
        run: |
          docker-compose build web
      - name: Do tests
        run: |
          sudo docker-compose run web ./manage.py test
